<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epic Adventure</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.60.0/phaser.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        .dialogue-box {
            position: fixed;
            bottom: 0;
            width: 100%;
            height: 30vh;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 20px;
            font-family: Arial;
        }
    </style>
</head>
<body>
    <div id="game-container"></div>
    
<script>
const config = {
    type: Phaser.AUTO,
    parent: 'game-container',
    width: window.innerWidth,
    height: window.innerHeight,
    scene: {
        preload: preload,
        create: create,
        update: update
    },
    scale: {
        mode: Phaser.Scale.RESIZE,
        autoCenter: Phaser.Scale.CENTER_BOTH
    }
};

const game = new Phaser.Game(config);
let player, npc1, currentDialogue = null;
let dialogueVisible = false;
const gameState = {
    inventory: [],
    quests: {
        findSword: false
    }
};

const dialogues = {
    oldMan: {
        lines: [
            "Stranger! The kingdom is in peril...",
            "Find the ancient sword in the cave!",
            { text: "Accept quest?", options: ["Yes", "No"] }
        ],
        currentLine: 0
    }
};

function preload() {
    this.load.image('player', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo4MjRGRTg0QzA3NjgxMUUzQkZGNDhENEJFQjM2OTcyRiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo4MjRGRTg0RDA3NjgxMUUzQkZGNDhENEJFQjM2OTcyRiI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjgyNEZFODRBMDc2ODExRTNCRkY0OEQ0QkVCMzY5NzJGIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjgyNEZFODRCMDc2ODExRTNCRkY0OEQ0QkVCMzY5NzJGIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+Y7ZvUAAAA2FJREFUeNrEl21IU1EYx8+9d1tGU0stP5ShlqJmKRSKRlZQIWVFH4JIjSLRKILoRZGiD1FEUfQiJX4JoqgPFVH0QWtFWlZqWlZqWqZmmqW2zNx0c3f3djv/c889eGm6u3taBw6Xc8+95zz/5zyvc0RZlmU7L5fNl8vOAhAEwW5FQNM0SZKsCGAxVVWtCGAxTdOsCGAxXdetCGi6rtsQ0DQrAqphNwRCoZAVgYBhNwSCwaAVgT7Dbgj4/X4rAj2G3RDo7e21ItBp2A2Brq4uKwLtht0QaGtrsyLQYtgNgZaWFisCjYbdEKivr7ciUGPYDYG6ujorAnWG3RCoqamxIlBt2A2ByspKKwIVht0QKCsrsyJQatgNgeLiYisCRYbdEMjLy7Mi8MOwGwLZ2dlWBL4ZdkPg69evVgS+GHZDICMjw4rAJ8NuCKSnp1sRSDPshkBqaqoVgQ+G3RBISUmxIpBs2A2Bd+/eWRF4a9gNgaSkJCsCiYbdEHj9+rUVgVeG3RB48eKFFYHnht0QePr0qRWBJ4bdEHj8+LEVgUTDbgg8evTIisADw24I3L9/34rAPcNuCNy5c8eKwG3DbgjcvHnTisANw24IXLt2zYrAVcNuCFy5csWKwGXDbghcunTJisBFw24InD9/3orABcNuCJw9e9aKwDnDbgicPn3aisAZw24InDx50orACcNuCCQkJFgROG7YDYFjx45ZEThq2A2Bw4cPWxGIN+yGwKFDh6wIHDTshsCBAwesCOw37IbA3r17rQjsMeyGwO7du60I7DLshsDOnTutCGw37IZAXFycFYFtht0Q2LJli4UArP4fAQYAzV5q+BjQh1MAAAAASUVORK5CYII=');
    this.load.image('npc', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo4QzNGRTE2QTA3NjgxMUUzQkZGNDhENEJFQjM2OTcyRiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo4QzNGRTE2QjA3NjgxMUUzQkZGNDhENEJFQjM2OTcyRiI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjhDM0ZFMTY4MDc2ODExRTNCRkY0OEQ0QkVCMzY5NzJGIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjhDM0ZFMTY5MDc2ODExRTNCRkY0OEQ0QkVCMzY5NzJGIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+GHfH4AAAAw5JREFUeNrElk9IU1EYx8+9d3acm5p/UtMPZailqFkKhaKRFVRIWdGHIFKjSDSKIHpRpOhDFFEEvUiJn4Io6kNF6rZoaam5aWqmpmmZmmnWpjN3d3fv3Xvvcx5e2gqbu9Pt8MCBc8/5nd/5nXPeI0iSJNt5OWy+HHYWgCAIdisCqqqqsmxFQJZlWVEUKwJYTNM0KwJYTNM0KwJYTNd1OwJ2HdA0zY6Aqut2BFRdtywQCoWsCPgNuyHg8/msCHQadkOgo6PDikC7YTcE2trarAi0GnZDoKWlxYpAs2E3BJqamqwINBp2Q6ChocGKQL1hNwTq6uqsCNQadkOgtraWX0CSpDHDbggEg0ErAmHDbggEg0ErAhHDbggEg0ErAlHDbggEg0ErAjHDbggEg0ErAnHDbggEg0ErAgnDbggEg0ErAknDbggEg0ErAmnDbggEg0ErAhnDbggEg0ErAlnDbggEg0ErAnnDbggEg0ErAgXDbggEg0ErAkXDbggEg0ErAiXDbggEg0ErAmXDbggEg0ErAhXDbggEg0ErAlXDbggEg0ErAnXDbggEg0ErAg3DbggEg0ErAk3DbggEg0ErAi3DbggEg0ErAm3DbggEg0ErAh3DbggEg0ErAl3DbggEg0ErAj3DbggEg0ErAn3DbggEg0ErAgPDbggEg0ErAkPDbggEg0ErAiPDbggEg0ErAmPDbggEg0ErAhPDbggEg0ErAlPDbggEg0ErAjPDbggEg0ErAnPDbggEg0ErAgvDbggEg0ErAkvDbggEg0ErAmvDbggEg0ErAhvDbggEg0ErAlvDbggEg0ErAnvDbggEg0ErAgfDbggEg0ErAkfDbggEg0ErAifDbggEg0ErAmfDbggEg0ErAhfDbggEg0ErAlfDbggEg0ErAjfDbggEg0ErAnfDbggEg0ErAg/DbggEg0ErAk/DbggEg0ErAi/DbggEg0ErAm/DbggEg0ErAh/DbggEg0ErAn/DbggEg0ErAv8EGACFyY+B4Bw0ZgAAAABJRU5ErkJggg==');
}

function create() {
    // Create game world
    this.add.image(400, 300, 'background');
    
    player = this.physics.add.sprite(100, 450, 'player');
    player.setCollideWorldBounds(true);
    
    npc1 = this.physics.add.sprite(600, 450, 'npc');
    npc1.name = 'Old Man';
    
    // Enable cursor keys
    cursors = this.input.keyboard.createCursorKeys();
    
    // Touch input
    this.input.on('pointerdown', (pointer) => {
        if (!dialogueVisible) {
            player.x = pointer.x;
            player.y = pointer.y;
        }
    });
    
    // Interaction system
    this.physics.add.overlap(player, npc1, startDialogue, null, this);
}

function update() {
    // Keyboard movement
    if (cursors.left.isDown) {
        player.x -= 3;
    } else if (cursors.right.isDown) {
        player.x += 3;
    }
    
    if (cursors.up.isDown) {
        player.y -= 3;
    } else if (cursors.down.isDown) {
        player.y += 3;
    }
}

function startDialogue() {
    if (dialogueVisible) return;
    
    currentDialogue = dialogues.oldMan;
    showDialogueBox();
}

function showDialogueBox() {
    dialogueVisible = true;
    const box = document.createElement('div');
    box.className = 'dialogue-box';
    box.innerHTML = `
        <h3>${npc1.name}</h3>
        <p>${currentDialogue.lines[currentDialogue.currentLine].text || 
           currentDialogue.lines[currentDialogue.currentLine]}</p>
        ${currentDialogue.lines[currentDialogue.currentLine].options ? 
           currentDialogue.lines[currentDialogue.currentLine].options.map(
               (opt, i) => `<button onclick="handleOption(${i})">${opt}</button>`
           ).join('') : '<button onclick="nextLine()">Continue</button>'}
    `;
    document.body.appendChild(box);
}

function nextLine() {
    currentDialogue.currentLine++;
    updateDialogue();
}

function handleOption(choice) {
    if (choice === 0) {
        gameState.quests.findSword = true;
    }
    currentDialogue.currentLine++;
    updateDialogue();
}

function updateDialogue() {
    const box = document.querySelector('.dialogue-box');
    if (currentDialogue.currentLine >= currentDialogue.lines.length) {
        box.remove();
        dialogueVisible = false;
        currentDialogue.currentLine = 0;
        return;
    }
    
    box.innerHTML = `
        <h3>${npc1.name}</h3>
        <p>${currentDialogue.lines[currentDialogue.currentLine].text || 
           currentDialogue.lines[currentDialogue.currentLine]}</p>
        ${currentDialogue.lines[currentDialogue.currentLine].options ? 
           currentDialogue.lines[currentDialogue.currentLine].options.map(
               (opt, i) => `<button onclick="handleOption(${i})">${opt}</button>`
           ).join('') : '<button onclick="nextLine()">Continue</button>'}
    `;
}

// Mobile controls
if ('ontouchstart' in window) {
    window.addEventListener('load', () => {
        const joystick = document.createElement('div');
        joystick.style.position = 'fixed';
        joystick.style.bottom = '20px';
        joystick.style.left = '20px';
        joystick.innerHTML = `
            <button style="padding:15px" ontouchstart="movePlayer(-3,0)">←</button>
            <button style="padding:15px" ontouchstart="movePlayer(3,0)">→</button>
        `;
        document.body.appendChild(joystick);
    });
}

function movePlayer(x, y) {
    player.x += x;
    player.y += y;
}
</script>
</body>
</html>