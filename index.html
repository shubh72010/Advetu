<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>Mini Adventure Game</title>
<style>
  html, body {
    margin: 0; padding: 0; height: 100%; overflow: hidden;
    background: #222;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: white;
  }
  #gameCanvas {
    display: block;
    margin: auto;
    background: #333;
    image-rendering: pixelated;
    touch-action: none;
  }
  #dialogueBox {
    position: fixed;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 600px;
    background: rgba(0,0,0,0.8);
    border: 2px solid #fff;
    border-radius: 8px;
    padding: 15px;
    font-size: 1.2em;
    display: none;
    user-select: none;
  }
  #dialogueBox button {
    margin-top: 10px;
    padding: 8px 15px;
    font-size: 1em;
    background: #555;
    border: none;
    border-radius: 5px;
    color: white;
    cursor: pointer;
  }
  #dialogueBox button:hover {
    background: #777;
  }
</style>
</head>
<body>

<canvas id="gameCanvas" width="320" height="320"></canvas>

<div id="dialogueBox">
  <div id="dialogueText"></div>
  <button id="nextBtn">Next</button>
</div>

<script>
// --- Game Setup ---
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scale = 2; // scale up for mobile clarity
canvas.style.width = canvas.width * scale + 'px';
canvas.style.height = canvas.height * scale + 'px';

const dialogueBox = document.getElementById('dialogueBox');
const dialogueText = document.getElementById('dialogueText');
const nextBtn = document.getElementById('nextBtn');

const TILE_SIZE = 16;
const MAP_WIDTH = 20;
const MAP_HEIGHT = 20;

// Simple tile map: 0 = floor, 1 = wall
const map = [
  // 20x20 grid, simple room with walls around
  1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
  1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
  1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
  1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
  1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
  1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
  1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
  1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
  1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
  1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
  1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
  1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
  1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
  1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
  1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
  1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
  1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
  1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
  1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
  1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
];

// Player and NPC positions
let player = { x: 10, y: 10, color: '#0f0' };
const npcs = [
  {
    x: 5,
    y: 5,
    color: '#f00',
    name: 'Old Man',
    dialogue: [
      "Hello traveler!",
      "Beware of the dark forest ahead.",
      "Good luck on your journey!"
    ],
    dialogueIndex: 0,
  }
];

// Game state
let keysPressed = {};
let inDialogue = false;
let currentNPC = null;

// Draw functions
function drawTile(x, y, color) {
  ctx.fillStyle = color;
  ctx.fillRect(x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
}

function drawMap() {
  for (let y = 0; y < MAP_HEIGHT; y++) {
    for (let x = 0; x < MAP_WIDTH; x++) {
      let tile = map[y * MAP_WIDTH + x];
      if (tile === 1) {
        drawTile(x, y, '#555'); // wall
      } else {
        drawTile(x, y, '#222'); // floor
      }
    }
  }
}

function drawPlayer() {
  drawTile(player.x, player.y, player.color);
}

function drawNPCs() {
  npcs.forEach(npc => {
    drawTile(npc.x, npc.y, npc.color);
  });
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawMap();
  drawNPCs();
  drawPlayer();
}

// Movement & collision
function canMove(x, y) {
  if (x < 0 || x >= MAP_WIDTH || y < 0 || y >= MAP_HEIGHT) return false;
  if (map[y * MAP_WIDTH + x] === 1) return false;
  return true;
}

function checkNPCInteraction() {
  for (let npc of npcs) {
    if (Math.abs(player.x - npc.x) <= 1 && Math.abs(player.y - npc.y) <= 1) {
      return npc;
    }
  }
  return null;
}

// Dialogue handling
function startDialogue(npc) {
  inDialogue = true;
  currentNPC = npc;
  npc.dialogueIndex = 0;
  dialogueText.textContent = npc.dialogue[npc.dialogueIndex];
  dialogueBox.style.display = 'block';
}

function advanceDialogue() {
  if (!currentNPC) return;
  currentNPC.dialogueIndex++;
  if (currentNPC.dialogueIndex >= currentNPC.dialogue.length) {
    endDialogue();
  } else {
    dialogueText.textContent = currentNPC.dialogue[currentNPC.dialogueIndex];
  }
}

function endDialogue() {
  inDialogue = false;
  currentNPC = null;
  dialogueBox.style.display = 'none';
}

// Input handlers
window.addEventListener('keydown', e => {
  if (inDialogue) return;
  keysPressed[e.key] = true;
});

window.addEventListener('keyup', e => {
  keysPressed[e.key] = false;
});

nextBtn.addEventListener('click', () => {
  advanceDialogue();
});

// Simple touch controls for mobile: swipe to move
let touchStartX = null;
let touchStartY = null;

canvas.addEventListener('touchstart', e => {
  if (inDialogue) return;
  const touch = e.touches[0];
  touchStartX = touch.clientX;
  touchStartY = touch.clientY;
});

canvas.addEventListener('touchend', e => {
  if (inDialogue) return;
  if (touchStartX === null || touchStartY === null) return;
  const touch = e.changedTouches[0];
  const dx = touch.clientX - touchStartX;
  const dy = touch.clientY - touchStartY;
  if (Math.abs(dx) > Math.abs(dy)) {
    if (dx > 30) tryMove(1, 0);
    else if (dx < -30) tryMove(-1, 0);
  } else {
    if (dy > 30) tryMove(0, 1);
    else if (dy < -30) tryMove(0, -1);
  }
  touchStartX = null;
  touchStartY = null;
});

// Try to move player and check for NPC interaction
function tryMove(dx, dy) {
  const newX = player.x + dx;
  const newY = player.y + dy;
  if (canMove(newX, newY)) {
    player.x = newX;
    player.y = newY;
    const npc = checkNPCInteraction();
    if (npc) {
      startDialogue(npc);
    }
  }
}

// Game loop
function update() {
  if (!inDialogue) {
    if (keysPressed['ArrowUp'] || keysPressed['w']) tryMove(0, -1);
    else if (keysPressed['ArrowDown'] || keysPressed['s']) tryMove(0, 1);
    else if (keysPressed['ArrowLeft'] || keysPressed['a']) tryMove(-1, 0);
    else if (keysPressed['ArrowRight'] || keysPressed['d']) tryMove(1, 0);
  }
}

function gameLoop() {
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>

</body>
</html>
